package ru.nekostul.nekostulai.ai.nekostuloffline;

import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

import java.util.HashMap;
import java.util.Map;

public class CraftHelper {

    private static final Map<String, String> RECIPES = new HashMap<>();

    static {
        put("факел", "палка снизу, уголь или древесный уголь сверху.");
        put("верстак", "4 доски в квадрате 2x2.");
        put("печь", "8 булыжника по кругу, центр пустой.");
        put("сундук", "8 досок по кругу, центр пустой.");
        put("кровать", "3 доски снизу, 3 шерсти сверху.");
        put("палка", "2 доски вертикально.");
        put("деревянная кирка", "3 доски сверху, 2 палки по центру.");
        put("каменная кирка", "3 булыжника сверху, 2 палки по центру.");
        put("железная кирка", "3 железных слитка сверху, 2 палки по центру.");
        put("алмазная кирка", "3 алмаза сверху, 2 палки по центру.");
        put("дверь деревянная", "6 досок, 3 сверху, 3 снизу.");
        put("дверь железная", "6 железных слитков, 3 сверху, 3 снизу.");
        put("люк", "6 досок, 2 ряда по 3.");
        put("люк железный", "4 железных слитка в квадрате 2x2.");
        put("забор", "4 палки, 2 доски по центру.");
        put("заборные ворота", "4 палки по бокам, 2 доски по центру.");
        put("лестница", "6 досок, 3 ряда по 2.");
        put("плита", "3 блока в ряд.");
        put("факел редстоуновый", "1 палка снизу, 1 редстоун сверху.");
        put("фонарь", "8 железных самородков по кругу, факел по центру.");
        put("цепь", "2 железных самородка сверху и снизу, слиток по центру.");
        put("сундук-ловушка", "сундук, нажимная плита сверху.");
        put("бочка", "6 досок по бокам, 2 плиты сверху и снизу.");
        put("кафедра", "4 плиты, 1 книжная полка сверху.");
        put("книжная полка", "3 книги по центру, 6 досок сверху и снизу.");
        put("стол зачарований", "2 алмаза, 4 обсидиана, 1 книга сверху.");
        put("наковальня", "3 железных блока сверху, 1 слиток по центру, 3 слитка снизу.");
        put("точило", "2 палки по бокам, плита сверху, каменная плита снизу.");
        put("каменорез", "1 железный слиток сверху, 3 камня снизу.");
        put("плавильная печь", "5 железных слитков, печь по центру.");
        put("коптильня", "печь по центру, 4 бревна по бокам.");
        put("верстак картографа", "2 бумаги сверху, верстак снизу.");
        put("верстак лучника", "3 палки по бокам, 2 доски сверху.");
        put("верстак кожевника", "котёл сверху, 2 доски снизу.");
        put("верстак каменщика", "каменная плита сверху, верстак снизу.");
        put("верстак кузнеца", "2 железных слитка сверху, 4 доски снизу.");
        put("верстак ткача", "2 нити сверху, 2 доски снизу.");
        put("верстак компостера", "7 плит по кругу.");
        put("компостер", "7 плит по кругу.");
        put("котёл", "7 железных слитков по форме U.");
        put("ведро", "3 железных слитка по форме V.");
        put("ведро воды", "ведро, наполненное водой.");
        put("ведро лавы", "ведро, наполненное лавой.");
        put("часы", "4 золотых слитка вокруг редстоуна.");
        put("компас", "4 железных слитка вокруг редстоуна.");
        put("карта", "8 бумаг вокруг компаса.");
        put("пустая карта", "8 бумаг.");
        put("ножницы", "2 железных слитка по диагонали.");
        put("огниво", "1 железный слиток, 1 кремень.");
        put("лук", "3 палки дугой, 3 нити.");
        put("арбалет", "3 палки, 2 нити, 1 железный слиток.");
        put("стрела", "кремень сверху, палка по центру, перо снизу.");
        put("фейерверк", "бумага и порох.");
        put("ракетница", "1 фейерверк.");
        put("щит", "6 досок, 1 железный слиток сверху.");
        put("шлем кожаный", "5 кожи.");
        put("нагрудник кожаный", "8 кожи.");
        put("поножи кожаные", "7 кожи.");
        put("ботинки кожаные", "4 кожи.");
        put("шлем железный", "5 железных слитков.");
        put("нагрудник железный", "8 железных слитков.");
        put("поножи железные", "7 железных слитков.");
        put("ботинки железные", "4 железных слитка.");
        put("шлем алмазный", "5 алмазов.");
        put("нагрудник алмазный", "8 алмазов.");
        put("поножи алмазные", "7 алмазов.");
        put("ботинки алмазные", "4 алмаза.");
        put("шлем незеритовый", "алмазный шлем, незеритовый слиток.");
        put("нагрудник незеритовый", "алмазный нагрудник, незеритовый слиток.");
        put("поножи незеритовые", "алмазные поножи, незеритовый слиток.");
        put("ботинки незеритовые", "алмазные ботинки, незеритовый слиток.");
        put("кровать", "3 доски снизу, 3 шерсти сверху.");
        put("табличка", "6 досок, 1 палка снизу.");
        put("рамка", "8 палок вокруг кожи.");
        put("картина", "8 палок вокруг шерсти.");
        put("рычаг", "палка сверху, булыжник снизу.");
        put("кнопка", "1 блок.");
        put("нажимная плита", "2 блока в ряд.");
        put("редстоун-факел", "редстоун сверху, палка снизу.");
        put("повторитель", "2 редстоун-факела, 3 камня, 1 редстоун.");
        put("компаратор", "3 редстоун-факела, 3 камня, 1 кварц.");
        put("липкий поршень", "поршень, слизь.");
        put("поршень", "3 доски сверху, 4 булыжника, 1 железо, 1 редстоун.");
        put("воронка", "5 железных слитков, сундук по центру.");
        put("раздатчик", "лук по центру, 7 булыжника, 1 редстоун.");
        put("выбрасыватель", "7 булыжника, 1 редстоун.");
        put("наблюдатель", "6 булыжника, 2 редстоуна, 1 кварц.");
        put("датчик дневного света", "3 стекла, 3 кварца, 3 деревянные плиты.");
        put("лампа редстоуновая", "4 светокамня, 4 редстоуна.");
        put("маяк", "5 стекла, 3 обсидиана, звезда незера.");
        put("кондуит", "8 раковин наутилуса, сердце моря.");
        put("якорь возрождения", "6 плачущего обсидиана, 3 светокамня.");
        put("щиток", "медный слиток, соты.");
        put("лодка", "5 досок, форма U.");
        put("лодка с сундуком", "лодка, сундук.");
        put("тележка", "5 железных слитков, форма U.");
        put("тележка с сундуком", "тележка, сундук.");
        put("тележка с печью", "тележка, печь.");
        put("тележка с воронкой", "тележка, воронка.");
        put("тележка с динамитом", "тележка, динамит.");
        put("тележка с спавнером", "тележка, спавнер.");
        put("седло", "кожа и железные слитки.");
        put("поводок", "4 нити, 1 слизь.");
        put("именная бирка", "бумага и нить.");
        put("колокол", "3 золотых слитка сверху, 1 железный блок снизу.");
        put("фонарь душ", "8 железных самородков, факел душ по центру.");
        put("факел душ", "палка, уголь душ или песок душ.");
        put("костёр", "3 палки, 3 бревна, 1 уголь.");
        put("костёр душ", "3 палки, 3 бревна, 1 уголь душ.");
        put("камень", "4 кварца.");
        put("кварцевый блок", "4 кварца.");
        put("кварцевые ступени", "6 кварцевых блоков.");
        put("кварцевая плита", "3 кварцевых блока.");
        put("кварцевая колонна", "2 кварцевых блока.");
        put("гладкий кварц", "кварцевый блок.");
        put("кирпичи", "4 кирпича.");
        put("каменные кирпичи", "4 камня.");
        put("потрескавшиеся каменные кирпичи", "каменные кирпичи.");
        put("мшистые каменные кирпичи", "каменные кирпичи, лианы или мох.");
        put("адский кирпич", "4 адских кирпича.");
        put("адские кирпичные ступени", "6 адских кирпичей.");
        put("адская кирпичная плита", "3 адских кирпича.");
        put("адский забор", "6 адских кирпичей.");
        put("пурпуровый блок", "4 плода хоруса.");
        put("пурпуровые ступени", "6 пурпуровых блоков.");
        put("пурпуровая плита", "3 пурпуровых блока.");
        put("пурпуровый столб", "2 пурпуровых блока.");
        put("энд стержень", "огненный стержень, плод хоруса.");
        put("глаз эндера", "жемчуг эндера, огненный порошок.");
        put("око паука", "паучий глаз, гриб, сахар.");
        put("огненный порошок", "огненный стержень.");
        put("магма крем", "слизь, огненный порошок.");
        put("книга", "3 бумаги, кожа.");
        put("книга с пером", "книга, перо, чернильный мешок.");
        put("бумага", "3 сахарных тростника.");
        put("чернила", "чернильный мешок.");
        put("мешок", "кожа и нити.");
        put("цветной мешок", "мешок, краситель.");
        put("ковёр", "2 шерсти.");
        put("окрашенная шерсть", "шерсть, краситель.");
        put("стекло", "песок.");
        put("окрашенное стекло", "8 стекла, краситель.");
        put("стеклянная панель", "6 стекла.");
        put("бетон", "4 песка, 4 гравия, краситель.");
        put("бетонный порошок", "4 песка, 4 гравия, краситель.");
        put("терракота", "глина.");
        put("окрашенная терракота", "8 терракоты, краситель.");
        put("глазурованная керамика", "окрашенная терракота.");
        put("лестница из верёвок", "7 палок.");
        put("знак", "6 досок, палка.");
        put("подвесной знак", "2 цепи, 6 обтёсанных брёвен.");
        put("рамка светящаяся", "рамка, светокамень.");
        put("кристалл аметиста", "осколки аметиста.");
        put("подзорная труба", "2 медных слитка, осколок аметиста.");
        put("громоотвод", "3 медных слитка.");
        put("молниеотвод", "3 медных слитка.");
        put("медный блок", "9 медных слитков.");
        put("резной медный блок", "4 медных блока.");
        put("медные ступени", "6 медных блоков.");
        put("медная плита", "3 медных блока.");
        put("кисть", "перо, палка, медный слиток.");
        put("арфа", "8 досок, 1 редстоун.");
        put("ноутблок", "8 досок, 1 редстоун.");
        put("тотем бессмертия", "золотые слитки и изумруды.");
        put("изумрудный блок", "9 изумрудов.");
        put("сахар", "сахарный тростник.");
        put("печенье", "2 пшеницы, какао-бобы.");
        put("торт", "3 молока, 2 сахара, яйцо, 3 пшеницы.");
        put("тыквенный пирог", "тыква, яйцо, сахар.");
        put("хлеб", "3 пшеницы.");
        put("золотое яблоко", "яблоко, 8 золотых слитков.");
        put("зачарованное яблоко", "яблоко, 8 золотых блоков.");
        put("флаг", "6 шерсти, палка.");
        put("узор флага", "бумага и предмет.");
        put("череп визера", "3 черепа визера, 4 песка душ.");

    }

    // =====================================================

    public static @Nullable String getRecipe(@Nullable String rawItem) {
        if (rawItem == null || rawItem.isBlank()) return null;

        String item = normalizeItem(rawItem);

        // точное совпадение
        if (RECIPES.containsKey(item)) {
            return RECIPES.get(item);
        }

        // частичное совпадение
        for (Map.Entry<String, String> e : RECIPES.entrySet()) {
            if (e.getKey().startsWith(item) || item.startsWith(e.getKey())) {
                return e.getValue();
            }
        }

        return null;
    }

    // =====================================================

    private static void put(String key, String value) {
        RECIPES.put(normalizeItem(key), value);
    }

    /**
     * Нормализует ТОЛЬКО название предмета.
     * Никаких глаголов, никаких "как", никаких "скрафтить".
     */
    private static @NotNull String normalizeItem(@NotNull String input) {
        String s = input
                .toLowerCase()
                .replaceAll("[^а-яa-z ]", "")
                .trim();

        // специальные формы
        if (s.startsWith("печ")) return "печь";
        if (s.startsWith("фак")) return "факел";
        if (s.startsWith("верс")) return "верстак";

        // падежи
        String[] endings = {
                "ами", "ями",
                "ов", "ев",
                "ах", "ях",
                "у", "ю",
                "а", "я",
                "е",
                "ь"
        };

        for (String end : endings) {
            if (s.length() > 3 && s.endsWith(end)) {
                s = s.substring(0, s.length() - end.length());
                break;
            }
        }

        return s.trim();
    }
}